import{T as F,S as I,C as _,P as E,W as j,a as y,V as f,b as w,c as P}from"./three.module-dwYFqkzA.js";import{S as p}from"./SpriteAnimatorShader-BXx9UAM9.js";const T=document.getElementById("spriteFileInput"),b=document.getElementById("jsonFileInput"),A=document.getElementById("spriteFileStatus"),U=document.getElementById("jsonFileStatus"),l=document.querySelector("canvas.webgl"),B=new F;let g=null,o=[],h={w:0,h:0},R=!1,S=25,x=1e3/S;function C(t){return fetch(t).then(e=>{if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);return e.json()})}const d=new I;d.background=new _(8026746);const a={width:l.clientWidth,height:l.clientHeight},c=new E(75,a.width/a.height,.1,100);c.position.set(0,0,.8);d.add(c);const u=new j({canvas:l,antialias:!0});u.setSize(a.width,a.height);u.setPixelRatio(window.devicePixelRatio);const s=new y({uniforms:{_spriteAtlasTex:{value:null},_frame:{value:new f(0,0,0,0)},_spriteAtlasSize:{value:new w(0,0)},_sourceSize:{value:new w(0,0)},_spriteSourceSize:{value:new f(0,0,0,0)},_isRotated:{value:!1}},vertexShader:p.vertexShader,fragmentShader:p.fragmentShader,transparent:!0}),O=new P(s);d.add(O);window.addEventListener("resize",()=>{a.width=l.clientWidth,a.height=l.clientHeight,c.aspect=a.width/a.height,c.updateProjectionMatrix(),u.setSize(a.width,a.height),u.setPixelRatio(window.devicePixelRatio)});let i=0,v=Date.now();function z(){requestAnimationFrame(z);const t=Date.now();if(R&&t-v>=x){i=(i+1)%o.length;const e=o[i].frame,r=o[i].sourceSize,n=o[i].spriteSourceSize,L=o[i].rotated;s.uniforms._frame.value.set(e.x,e.y,e.w,e.h),s.uniforms._sourceSize.value.set(r.w,r.h),s.uniforms._spriteSourceSize.value.set(n.x,n.y,n.w,n.h),s.uniforms._isRotated.value=L,v=t;const m=r.w/r.h;m>1?plane.scale.set(1,1/m,1):plane.scale.set(m,1,1)}u.render(d,c)}z();T.addEventListener("change",t=>{const e=t.target.files&&t.target.files[0];if(!e)return;const r=URL.createObjectURL(e);g=B.load(r,()=>{A.textContent=`Sprite loaded: ${e.name}`,s.uniforms._spriteAtlasTex.value=g})});b.addEventListener("change",t=>{const e=t.target.files&&t.target.files[0];if(!e)return;const r=URL.createObjectURL(e);C(r).then(n=>{o=n.frames,h=n.meta.size,s.uniforms._spriteAtlasSize.value.set(h.w,h.h),R=!0,U.textContent=`JSON loaded: ${e.name}`}).catch(n=>{console.error("Error loading JSON:",n)})});const D=document.getElementById("frameRateInput");D.addEventListener("change",t=>{S=parseInt(t.target.value,10)||25,x=1e3/S});

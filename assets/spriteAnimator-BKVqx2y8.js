import{T as I,S as _,C as E,P as y,W as P,a as j,V as S,b as p,c as T,M as b}from"./three.module-D6KpNp-z.js";import{S as g}from"./SpriteAnimatorShader-BXx9UAM9.js";const A=document.getElementById("spriteFileInput"),U=document.getElementById("jsonFileInput"),B=document.getElementById("spriteFileStatus"),C=document.getElementById("jsonFileStatus"),l=document.querySelector("canvas.webgl"),O=new I;let v=null,o=[],h={w:0,h:0},x=!1,w=25,z=1e3/w;function D(t){return fetch(t).then(e=>{if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);return e.json()})}const d=new _;d.background=new E(8026746);const a={width:l.clientWidth,height:l.clientHeight},c=new y(75,a.width/a.height,.1,100);c.position.set(0,0,.8);d.add(c);const u=new P({canvas:l,antialias:!0});u.setSize(a.width,a.height);u.setPixelRatio(window.devicePixelRatio);const s=new j({uniforms:{_spriteAtlasTex:{value:null},_frame:{value:new S(0,0,0,0)},_spriteAtlasSize:{value:new p(0,0)},_sourceSize:{value:new p(0,0)},_spriteSourceSize:{value:new S(0,0,0,0)},_isRotated:{value:!1}},vertexShader:g.vertexShader,fragmentShader:g.fragmentShader,transparent:!0}),M=new T(1,1),f=new b(M,s);d.add(f);window.addEventListener("resize",()=>{a.width=l.clientWidth,a.height=l.clientHeight,c.aspect=a.width/a.height,c.updateProjectionMatrix(),u.setSize(a.width,a.height),u.setPixelRatio(window.devicePixelRatio)});let i=0,R=Date.now();function L(){requestAnimationFrame(L);const t=Date.now();if(x&&t-R>=z){i=(i+1)%o.length;const e=o[i].frame,r=o[i].sourceSize,n=o[i].spriteSourceSize,F=o[i].rotated;s.uniforms._frame.value.set(e.x,e.y,e.w,e.h),s.uniforms._sourceSize.value.set(r.w,r.h),s.uniforms._spriteSourceSize.value.set(n.x,n.y,n.w,n.h),s.uniforms._isRotated.value=F,R=t;const m=r.w/r.h;m>1?f.scale.set(1,1/m,1):f.scale.set(m,1,1)}u.render(d,c)}L();A.addEventListener("change",t=>{const e=t.target.files&&t.target.files[0];if(!e)return;const r=URL.createObjectURL(e);v=O.load(r,()=>{B.textContent=`Sprite loaded: ${e.name}`,s.uniforms._spriteAtlasTex.value=v})});U.addEventListener("change",t=>{const e=t.target.files&&t.target.files[0];if(!e)return;const r=URL.createObjectURL(e);D(r).then(n=>{o=n.frames,h=n.meta.size,s.uniforms._spriteAtlasSize.value.set(h.w,h.h),x=!0,C.textContent=`JSON loaded: ${e.name}`}).catch(n=>{console.error("Error loading JSON:",n)})});const W=document.getElementById("frameRateInput");W.addEventListener("change",t=>{w=parseInt(t.target.value,10)||25,z=1e3/w});

import{T as U,S as G,P as M,W as D,d as W,R as $,a as P,V as R,b as g,C as k,c as H,M as C,e as q}from"./three.module-D6KpNp-z.js";import{O as x,G as J}from"./Outline2DShader-DX2DK67Z.js";import{S as F}from"./SpriteAnimatorShader-BXx9UAM9.js";const V=document.getElementById("spriteFileInput"),N=document.getElementById("jsonFileInput"),K=document.getElementById("spriteFileStatus"),Q=document.getElementById("jsonFileStatus"),f=document.querySelector("canvas.webgl"),L=new U;let z=null,u=[],w={w:0,h:0},T=!1,_=25,y=1e3/_;L.load("./assets/Flower.png");function X(t){return fetch(t).then(e=>{if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);return e.json()})}const S=new G,a={width:f.clientWidth,height:f.clientHeight},d=new M(75,a.width/a.height,.1,100);d.position.set(0,0,.8);S.add(d);const s=new D({canvas:f,antialias:!0,alpha:!0});s.setSize(a.width,a.height);s.setPixelRatio(window.devicePixelRatio);const I=new W(a.width,a.height,{format:$,transparent:!0,premultipliedAlpha:!1}),o=new P({uniforms:{_spriteAtlasTex:{value:null},_frame:{value:new R(0,0,0,0)},_spriteAtlasSize:{value:new g(0,0)},_sourceSize:{value:new g(0,0)},_spriteSourceSize:{value:new R(0,0,0,0)},_isRotated:{value:!1}},vertexShader:F.vertexShader,fragmentShader:F.fragmentShader,transparent:!0}),c={_spriteTex:{value:I.texture},_outlineThickness:{value:10},_outlineColor:{value:new k(65280)},_outlineOpacity:{value:1},_ringCount:{value:16},_offset:{value:new g(0,0)},_squareBorder:{value:!1},_isSecondPass:{value:!0}},E=new P({uniforms:c,vertexShader:x.vertexShader,fragmentShader:x.fragmentShader,transparent:!0}),A=new H(1,1),m=new C(A,o),h=new C(A,E);S.add(m);S.add(h);new q(E);window.addEventListener("resize",()=>{a.width=f.clientWidth,a.height=f.clientHeight,d.aspect=a.width/a.height,d.updateProjectionMatrix(),s.setSize(a.width,a.height),s.setPixelRatio(window.devicePixelRatio)});const b=new J;function Y(t,e,n,r){const p={color:`#${e[n].value.getHexString()}`};t.addColor(p,"color").name(r).onChange(i=>{e[n].value.set(i)})}const v=b.addFolder("Outline Properties");Y(v,c,"_outlineColor","Outline Color");v.add(c._outlineThickness,"value",0,100,.1).name("Outline Thickness");v.add(c._outlineOpacity,"value",0,1,.01).name("Outline Opacity");v.open();const j=b.addFolder("Outline Properties Advanced");j.add(c._ringCount,"value",0,100,1).name("Ring Count");j.add(c._isSecondPass,"value").name("Second Pass");let l=0,O=Date.now();function B(){requestAnimationFrame(B);const t=Date.now();if(T&&t-O>=y){l=(l+1)%u.length;const e=u[l].frame,n=u[l].sourceSize,r=u[l].spriteSourceSize,p=u[l].rotated;o.uniforms._frame.value.set(e.x,e.y,e.w,e.h),o.uniforms._sourceSize.value.set(n.w,n.h),o.uniforms._spriteSourceSize.value.set(r.x,r.y,r.w,r.h),o.uniforms._isRotated.value=p,O=t;const i=n.w/n.h;i>1?(m.scale.set(1,1/i,1),h.scale.set(1,1/i,1)):m.scale.set(i,1,1),h.scale.set(1,1/i,1)}m.visible=!0,h.visible=!1,s.setRenderTarget(I),s.render(S,d),m.visible=!1,h.visible=!0,s.setRenderTarget(null),s.render(S,d)}B();V.addEventListener("change",t=>{const e=t.target.files&&t.target.files[0];if(!e)return;const n=URL.createObjectURL(e);z=L.load(n,()=>{K.textContent=`Sprite loaded: ${e.name}`,o.uniforms._spriteAtlasTex.value=z})});N.addEventListener("change",t=>{const e=t.target.files&&t.target.files[0];if(!e)return;const n=URL.createObjectURL(e);X(n).then(r=>{u=r.frames,w=r.meta.size,o.uniforms._spriteAtlasSize.value.set(w.w,w.h),T=!0,Q.textContent=`JSON loaded: ${e.name}`}).catch(r=>{console.error("Error loading JSON:",r)})});const Z=document.getElementById("frameRateInput");Z.addEventListener("change",t=>{_=parseInt(t.target.value,10)||25,y=1e3/_});
